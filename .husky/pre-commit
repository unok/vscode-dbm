echo "ğŸ” Running pre-commit checks..."

# Dependencies check
echo "ğŸ“¦ Verifying dependencies..."
test -d node_modules && echo "âœ… Dependencies verified" || {
  echo "âŒ Node modules missing. Run 'npm install' first."
  exit 1
}

# Package.json validity check
echo "ğŸ“‹ Checking package.json validity..."
node -e "require('./package.json')" && echo "âœ… Package.json is valid" || {
  echo "âŒ Package.json is invalid."
  exit 1
}

# Lint check (strict mode for commits)
echo "ğŸ“ Running lint check (strict mode)..."
npm run lint:fix
if ! npm run lint:check; then
  echo "âŒ Lint issues found. All warnings must be resolved before committing."
  echo ""
  echo "Run 'npm run lint:fix' and manually fix remaining issues."
  exit 1
fi
echo "âœ… Lint check passed"

# TypeScript check (strict - blocks commit on errors)
echo "ğŸ” Running TypeScript type check..."
npm run type-check && echo "âœ… TypeScript check passed" || {
  echo "âŒ TypeScript type errors found. Fix these before committing."
  exit 1
}

echo "ğŸ—ï¸  Testing build process..."
npm run build && echo "âœ… Build successful" || {
  echo "âŒ Build failed. Fix build errors before committing."
  exit 1
}

echo ""
echo "ğŸ“ Pre-commit summary:"
echo "  âœ… Dependencies and package.json verified"
echo "  âœ… All lint issues resolved (strict mode)"
echo "  âœ… TypeScript type check passed"
echo "  âœ… Build process successful"
echo ""
echo "ğŸš€ Commit ready! All quality checks passed."